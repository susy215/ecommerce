{% extends "admin/base_site.html" %}
{% load i18n %}

{% block extrastyle %}
<style>
  .pred-grid { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 20px; 
    margin: 20px 0;
  }
  .pred-kpis { 
    display: grid; 
    grid-template-columns: repeat(3, 1fr); 
    gap: 10px; 
    margin-bottom: 20px;
  }
  .pred-kpi { 
    background: var(--darkened-bg); 
    padding: 15px; 
    border-radius: 4px;
    border-left: 3px solid var(--primary);
  }
  .pred-kpi h4 { 
    margin: 0 0 8px; 
    font-weight: 600; 
    font-size: 12px; 
    text-transform: uppercase;
    opacity: 0.8;
  }
  .pred-kpi .val { 
    font-size: 24px; 
    font-weight: 700; 
  }
  .pred-toolbar { 
    display: flex; 
    gap: 10px; 
    align-items: center; 
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  .pred-toolbar label {
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .pred-toolbar input[type="number"] {
    width: 60px;
    padding: 4px 6px;
  }
  @media (max-width: 1024px) { 
    .pred-grid { grid-template-columns: 1fr; } 
    .pred-kpis { grid-template-columns: 1fr; } 
  }
</style>
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
  <a href="{% url 'admin:index' %}">Inicio</a>
  &rsaquo; <a href="{% url 'admin:app_list' app_label='ia' %}">IA</a>
  &rsaquo; Predicción de Ventas
</div>
{% endblock %}

{% block content %}
<div id="content-main">
  
  <div class="module">
    <h2>Predicción de Ventas - Configuración</h2>
    <div style="padding: 15px;">
      <p class="help">
        Ajusta los parámetros para generar la predicción de ventas basada en el histórico.
      </p>
      
      <form method="get" class="pred-toolbar">
        <label>
          <span>Días histórico:</span>
          <input type="number" name="dias_hist" value="{{ dias_hist }}" min="7" max="365"/>
        </label>
        <label>
          <span>Días a predecir:</span>
          <input type="number" name="dias_forecast" value="{{ dias_forecast }}" min="1" max="60"/>
        </label>
        <label>
          <span>Ventana (media móvil):</span>
          <input type="number" name="ventana" value="{{ ventana }}" min="1" max="30"/>
        </label>
        <button type="submit" class="button">Actualizar</button>
        <button type="submit" class="button" name="download" value="csv">Descargar CSV</button>
      </form>
    </div>
  </div>

  <div class="module">
    <h2>KPIs - Histórico</h2>
    <div style="padding: 15px;">
      <div class="pred-kpis">
        <div class="pred-kpi">
          <h4>Total histórico</h4>
          <div class="val">{{ historico_total }}</div>
        </div>
        <div class="pred-kpi">
          <h4>Promedio histórico</h4>
          <div class="val">{{ historico_promedio }}</div>
        </div>
        <div class="pred-kpi">
          <h4>Último día</h4>
          <div class="val">{{ historico_ultimo_dia }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="module">
    <h2>KPIs - Pronóstico</h2>
    <div style="padding: 15px;">
      <div class="pred-kpis">
        <div class="pred-kpi">
          <h4>Total pronóstico</h4>
          <div class="val">{{ forecast_total }}</div>
        </div>
        <div class="pred-kpi">
          <h4>Promedio pronóstico</h4>
          <div class="val">{{ forecast_promedio }}</div>
        </div>
        <div class="pred-kpi">
          <h4>Horizonte (días)</h4>
          <div class="val">{{ dias_forecast }}</div>
        </div>
      </div>
    </div>
  </div>

  <div class="pred-grid">
    <div class="module">
      <h2>Histórico</h2>
      <div style="overflow-x: auto;">
        <table id="result_list">
          <thead>
            <tr>
              <th scope="col">Fecha</th>
              <th scope="col">Total</th>
            </tr>
          </thead>
          <tbody>
          {% for p in historico %}
            <tr class="{% cycle 'row1' 'row2' %}">
              <td>{{ p.fecha }}</td>
              <td>{{ p.total }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="module">
      <h2>Pronóstico</h2>
      <div style="overflow-x: auto;">
        <table id="result_list">
          <thead>
            <tr>
              <th scope="col">Fecha</th>
              <th scope="col">Total (estimado)</th>
            </tr>
          </thead>
          <tbody>
          {% for f in forecast %}
            <tr class="{% cycle 'row1' 'row2' %}">
              <td>{{ f.fecha }}</td>
              <td>{{ f.total }}</td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>
{% endblock %}
